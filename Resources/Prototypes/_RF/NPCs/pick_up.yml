- type: htnCompound
  id: PickUpCompound
  branches:
    - preconditions:
        - !type:OrPrecondition
          preconditions:
            - !type:EntityDeletedPrecondition
              key: PickUpTarget
            - !type:InInventoryPrecondition
              targetKey: PickUpTarget
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:RemoveKeyOperator
            key: PickUpTarget

    # Move to target
    - preconditions:
        - !type:KeyExistsPrecondition
          key: PickUpTarget
        - !type:TargetNotInRangePrecondition
          targetKey: PickUpTarget
          rangeKey: InteractRange
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:EntityCoordinatesOperator
            targetKey: PickUpTarget
        - !type:HTNCompoundTask
          task: MoveToInteractCompound

    # Remove anything from the hands that prevents from picking up the item
    - preconditions:
        - !type:ActiveHandEntityPrecondition
        - !type:KeyExistsPrecondition
          key: PickUpTarget
        - !type:ActiveHandEntityIsPrecondition
          targetKey: PickUpTarget
          invert: true
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:StorageOperator
    - preconditions:
        - !type:ActiveHandEntityPrecondition
        - !type:KeyExistsPrecondition
          key: PickUpTarget
        - !type:ActiveHandEntityIsPrecondition
          targetKey: PickUpTarget
          invert: true
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:DropOperator

    # Pick up the item
    - preconditions:
        - !type:KeyExistsPrecondition
          key: PickUpTarget
        - !type:TargetInRangePrecondition
          targetKey: PickUpTarget
          rangeKey: InteractRange
        - !type:ActiveHandEntityIsPrecondition
          targetKey: PickUpTarget
          invert: true
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:EquipOperator
            target: PickUpTarget
