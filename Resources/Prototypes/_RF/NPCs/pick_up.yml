- type: htnCompound
  id: PickUpCompound
  branches:
    - preconditions:
        - !type:EntityDeletedPrecondition
          key: PickUpTarget
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:RemoveKeyOperator
            key: PickUpTarget

    # Move to target
    - preconditions:
        - !type:KeyExistsPrecondition
          key: PickUpTarget
        - !type:TargetNotInRangePrecondition
          targetKey: PickUpTarget
          rangeKey: InteractRange
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:EntityCoordinatesOperator
            targetKey: PickUpTarget
        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
            pathfindInPlanning: true
            rangeKey: InteractRange
            removeKeyOnFinish: true

    # Remove anything from the hands that prevents from picking up the item
    - preconditions:
        - !type:ActiveHandEntityPrecondition
        - !type:KeyExistsPrecondition
          key: PickUpTarget
        - !type:ActiveHandEntityIsPrecondition
          targetKey: PickUpTarget
          invert: true
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:StorageOperator
    - preconditions:
        - !type:ActiveHandEntityPrecondition
        - !type:KeyExistsPrecondition
          key: PickUpTarget
        - !type:ActiveHandEntityIsPrecondition
          targetKey: PickUpTarget
          invert: true
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:DropOperator

    # Pick up the item
    - preconditions:
        - !type:KeyExistsPrecondition
          key: PickUpTarget
        - !type:TargetInRangePrecondition
          targetKey: PickUpTarget
          rangeKey: InteractRange
        - !type:ActiveHandEntityIsPrecondition
          targetKey: PickUpTarget
          invert: true
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:EquipOperator
            target: PickUpTarget
